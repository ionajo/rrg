<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8 />
		<title>Web page template</title>
		<meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
		<!-- External stylesheets -->
		<link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" />
		<!-- Cabin (in the woods) typeface -->
		<link href="https://fonts.googleapis.com/css?family=Cabin|Open+Sans:300,600" rel="stylesheet">
		<!-- Add JS data as a separate file -->
		<script src="locations.js"></script>
		<script src="rideHensley.js"></script>
		<style>
			body {
				margin: 0;
				padding: 0;
				background: #f5f5f5;
				font-family: "Lora";
				color: #3d3d3d;
				font-size: 100%;
				font-family: 'Open Sans', sans-serif;
			}
			section {
				width: 80%;
				margin: 20px auto;
			}
			h1 {
				/* Bigger!! */
				font-size: 2.5em;
				font-family: Lora, serif;
				letter-spacing: .04em;
				font-family: 'Cabin', sans-serif;
			}
			h2 {
				/* Maybe a little bigger? 1.75em */
				font-size: 1.5em;
				font-family: "Lora", serif;
				letter-spacing: .04em;
				font-family: 'Cabin', sans-serif;
			}
			h3,
			h4,
			h5,
			h6 {
				font-family: 'Cabin', sans-serif;
			}
			p {
				font-size: 1em;
				line-height: 1.5em;
			}
			a {
				color: #e38829;
				font-weight: bold;
				text-decoration: none;
			}
			a:hover {
				text-decoration: underline;
			}
			ul {
				padding-left: 40px;
			}
			li {
				margin: 10px 0;
			}
			#map {
				width: 100%;
				height: 540px;
				margin: 10px auto;
				border: 2px solid #d3d3d3;
			}
			#find_camps,
			#distance,
			#hensley_button {
				font-family: 'Cabin', sans-serif;
				font-size: 1.1em;
				line-height: 1.2em;
				background: rgba(250, 250, 250, 0.8);
			}
			#hensley_button {
				margin-bottom: 20px;
			}
			.two-column {
				float: left;
				width: 49%;
				margin-right: 1%;
			}
			.block-column {
				width: 100%;
				display: inline-block;
				margin-top: 20px;
			}
		</style>
	</head>
	<body>
		<!-- Title -->
		<section>
			<h1>Cumberland Gap National Historical Park</h1>
		</section>
		<!-- Map -->
		<!--style="width:100%;"-->
		<section>
			<div id='map'></div>
		</section>
		<!-- Textual content -->
		<section>
			<div class="two-column">
				<h2>Kentucky's first frontier</h2>
				<!-- Get more map content -->
				<button id="find_camps">Show backcountry campgrounds</button>| <button id="distance">Measure distance</button><br>
				<p>What trails will you blaze through this new frontier? Travel over ancient buffalo traces and Native American trails that frontier settlers cut into roads seeking the fertile lands of Kentucky. You will walk through Cumberland Gap where the Wilderness
				Road and the Warrior's Path meet and look out upon a wild frontier.</p>
			</div>
			<div class="two-column">
				<h2>Audio tour</h2>
				<button id="hensley_button">Ride up to Hensley Settlement</button><br>
				<iframe width="100%" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/playlists/237017090&amp;color=%23262626&amp;auto_play=false&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;show_teaser=true&amp;visual=true"></iframe>
			</div>
		</section>
		<!-- Photo -->
		<section>
			<div class="block-column">
				<button id="clickme_id">Photos of Cumberland Gap</button>
				<div id="photos_id"></div>
			</div>
		</section>
		<!-- Footer-->
		<section>
			<div>
				<hr>
				<ul>
					<li>More Cumberland Gap at: <a href="https://outrageGIS.com/gap">outrageGIS.com</a></li>
					<li>Follow me on twitter: <a href="https://twitter.com/boydshearer">@BoydShearer</a></li>
					<li>Visit my <a href="https://boydx.github.io">github.io</a> for other map projects</li>
				</ul>
			</div>
		</section>
		<!-- External scripts are loaded last when at linked at the bottom. Hepls page display faster -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.js"></script>
		<!-- My script -->
		<script>
			// show photograph
			clickme_id.addEventListener('click', function() {
				document.getElementById('photos_id').innerHTML =
					'<img src="https://farm6.staticflickr.com/5556/30626318041_7ee02eeb8e_h.jpg" width="100%" alt="The Gap">';
			});
			// map options
			var options = {
				center: [36.604, -83.674], // lat/lon values
				zoom: 12,
				zoomSnap: 0.2
			}
			// create a Leaflet map in our division container with id of 'map'
			var map = L.map('map', options);
			var CumberlandGap = L.tileLayer('https://www.outragegis.com/maps/gap/tiles/{z}/{x}/{y}.jpg', {
				maxZoom: 17,
				tms: true,
				attribution: 'outrageGIS mapping, QGIS, and QTiles'
			}).addTo(map);
			// write a custom message for the Leaflet tooltip
			var message = 'Cumberland Gap';
			// add a marker to the center of the map and open the tooltip
			L.marker(map.getCenter())
				.bindTooltip(message)
				.addTo(map);
			// Iterate through array of JS objects using indexes to access values for important features
			for (var i = 0; i < locations.features.length; i++) {
				// test if feeLocation array element is true
				if (locations.features[i].properties.fee === true) {
					var fee = "<br>The location charges a use fee. Contact Visitor Center for details.";
				} else {
					var fee = "";
				}
				// Build popup
				var locationPopup = "<h2>" + locations.features[i].name + "</h2>" + locations.features[i].properties.details + fee;
				// Build Leaflet icon
				var iconLocation = createIcon(locations.features[i].properties.type); // Function call
				L.marker(locations.features[i].properties.coordinates, {
						icon: iconLocation // Insert returned function value
					})
					.addTo(map)
					.bindPopup(locationPopup);
			};
			/* *************** Functions below here *************** */
			var lineStyle ={
				color: "red",
				opacity: 0.6,
				weight: 4,
				dashArray: "10,5"
			}
			var hensleyRide = L.layerGroup(); // define empty layer layerGroup
			document.getElementById('hensley_button').addEventListener("click", function() {
				y = document.getElementById('hensley_button');
				if (y.style.background.includes('rgba(146, 239, 146, 0.8)')) {
					y.style.background = 'rgba(250, 250, 250, 0.8)';
					map.off('click'); // disable click method
					hensleyRide.clearLayers() // clear all layers from layer group
				} else {
					y.style.background = 'rgba(146, 239, 146, 0.8)';
					var route = L.geoJson(rideHensley, {
						filter: function(feature) {
							if (feature.geometry.type == "LineString") {
								return feature;
							}
						},
						style: function(feature) {
							return lineStyle
						},
						onEachFeature: function(feature, layer) {
							popupContent = "<h2>" + feature.properties.name + "</h2>" + feature.properties.desc
							layer.bindPopup(popupContent)
						}
					}).addTo(hensleyRide);
					var myStops = L.geoJson(rideHensley, {
						filter: function(feature) {
							if (feature.geometry.type == "Point") {
								return feature;
							}
						},
						onEachFeature: function(feature, layer) {
							popupContent = "<h2>" + feature.properties.name + "</h2>" + feature.properties.desc + "<br>" + feature.properties.type
							layer.bindPopup(popupContent)
						},
						pointToLayer: function(feature, latlng) {
							return L.marker(latlng, {
								icon: createIcon("Stop")
							})
						}
					}).addTo(hensleyRide);
					// Add layer group to map
					hensleyRide.addTo(map)
					// Add interactivity for layers on map
					route.on('mouseover', function(e) {
						e.target.setStyle({
							color: "yellow"
						})
					})
					route.on('mouseout', function(e) {
						e.target.setStyle({
							color: "red"
						})
					})
					route.on('click', function() {
						map.fitBounds(route.getBounds());
					})
				}
			});
			// Add measurement Function
			var allMarkers = L.layerGroup(); // define empty layer layerGroup
			document.getElementById('distance').addEventListener("click", function() {
				// define empty variables
				var firstMarker, secondMarker, location, y
				y = document.getElementById('distance');
				if (y.style.background.includes('rgba(146, 239, 146, 0.8)')) {
					y.style.background = 'rgba(250, 250, 250, 0.8)';
					map.off('click'); // disable click method
					allMarkers.clearLayers() // clear all layers from layer group
				} else {
					y.style.background = 'rgba(146, 239, 146, 0.8)';
					window.alert("Click a location from where you want to measure distance. Drag the icon to measure distance.")
					map.on('click', function(e) {
						location = e.latlng.toString(); // create nice reading Lat/Long values
						firstMarker = L.marker(e.latlng, {
							draggable: true
						}).addTo(allMarkers)
						secondMarker = L.circle(e.latlng, {
							color: "purple",
							radius: 300
						}).bindTooltip(location).bindPopup(location).addTo(allMarkers);
						allMarkers.addTo(map); // add the layers to the Group
						firstMarker.on('drag', function(e) {
							location = e.latlng.toString() + "<br> distance from circle: " + (secondMarker.getLatLng().distanceTo(e.latlng) * 3.281 / 5280).toLocaleString() + " miles."
							firstMarker.bindTooltip(location).bindPopup(location).addTo(map)
						})
					})
				}
			});
			// Button function to map backcountry campsites
			var allCamps = L.layerGroup(); // define empty layer layerGroup
			x = 0
			document.getElementById('find_camps').addEventListener("click", function() {
				var y = document.getElementById('find_camps');
				console.log(y.style.background)
				// if (x === 1) {
					// 	y.style.background = 'rgba(250, 250, 250, 0.8)';
					// 	allCamps.clearLayers() // clear all layers from layer group
					// 	x = 0
				// } else {
					// 	x = 1
					// 	y.style.background = 'rgba(146, 239, 146, 0.8)';
					// 	var units = prompt("Pick elevation units", "feet or meters");
					// 	addBackcountryCamps(units); // function call
				// }
				if (y.style.background.includes('rgba(146, 239, 146, 0.8)')) {
					y.style.background = 'rgba(250, 250, 250, 0.8)';
					allCamps.clearLayers() // clear all layers from layer group
				} else {
					y.style.background = 'rgba(146, 239, 146, 0.8)';
					var units = prompt("Pick elevation units", "feet or meters");
					console.log(y.style.background)
					addBackcountryCamps(units); // function call
				}
			});
			// Function to add backcountry camps and give them popups and correct elevation units
			function addBackcountryCamps(elevationUnits) {
				// Iterate through array of JS objects using indexes to access values for different camps
				for (var i = 0; i < locations.camps.length; i++) {
					// Build popup
					var locationPopup = "<h2>" +
						locations.camps[i].name + "</h2>" +
						locations.camps[i].properties.type + "<br>Elevation is " +
						convertElevationUnits(elevationUnits, locations.camps[i].properties.elevationFeet); // Function call with two parameters
					// Build Leaflet icon
					var iconLocation = createIcon(locations.camps[i].properties.type); // Function call
					L.marker(locations.camps[i].properties.coordinates, {
							icon: iconLocation // Insert returned function value
						})
						.addTo(allCamps)
						.bindPopup(locationPopup);
				};
				allCamps.addTo(map)
			};
			// Function to create desired elevation units
			function convertElevationUnits(elevationUnits, elevationValue) {
				if (elevationUnits == "meters") {
					result = Math.round(elevationValue / 3.281) + " meters."
				} else {
					result = elevationValue + " feet."
				}
				return result;
			}
			// Function to create custom icons
			function createIcon(typeFacility) {
				var iconURL,
					iconSize = 30;
				if (typeFacility == "Vista") {
					iconURL = locations.icons[0];
				} else if (typeFacility == "Interpretive") {
					iconURL = locations.icons[1];
				} else if (typeFacility == "Campground") {
					iconURL = locations.icons[2];
				} else if (typeFacility == "Backcountry Camp") {
					iconURL = locations.icons[3];
					iconSize = 35;
				} else if (typeFacility == "Backcountry Horse Camp") {
					iconURL = locations.icons[4];
					iconSize = 35;
				} else {
					iconURL = locations.icons[5];
					iconSize = 20;
				};
				// Create a Leaflet icon object
				var result = L.icon({
					iconUrl: iconURL,
					iconSize: iconSize,
					popupAnchor: [0, -15]
				});
				return result;
			};
			// Try to have a little fun!
			console.log("Welcome to Cumberland Gap, fellow nerd.");
		</script>
	</body>
</html>